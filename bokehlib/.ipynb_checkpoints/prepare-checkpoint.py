import pandas as pd
import bokehlib.rowplotter as rowp
import glob
import os
def extract_csv(directory, filt_passive=True):  
    person_dir = directory
    number_dirs = glob.glob(person_dir+"*")
    csv_files = []

    for dire in number_dirs:
        try:
            if filt_passive:
                files = ["{}\\{}".format(dire,file) for file in os.listdir(dire) if (not "_passive_" in file) and (file.endswith("csv"))]
                csv_files.extend(files)
            else:
                files = ["{}\\{}".format(dire,file) for file in os.listdir(dire) if (file.endswith("csv"))]
                csv_files.extend(files)
        except NotADirectoryError:
            pass

    return csv_files

def create_dataframe(directory,csv_files=""):

    if not csv_files:
        csv_files = extract_csv(directory)

    data_df = pd.DataFrame()
    for csv_f in csv_files:
        data_df = data_df.append(pd.read_csv(csv_f))

    data_df.drop(columns=["Unnamed: 0","Unnamed: 0.1"],inplace=True,errors="ignore")
    
    data_df.drop(data_df[data_df['Longitude'] == "na"].index, inplace=True, errors="ignore")
    
    data_df['Longitude'] = data_df['Longitude'].astype(float)
    data_df['Latitude'] = data_df['Langitude'].astype(float)

    data_df['merc_x'], data_df['merc_y'] = rowp.convert_coords(data_df[['Longitude','Latitude']])
    
    return data_df