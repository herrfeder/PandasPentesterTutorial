\documentclass[convert={density=500,size=2000x2000,outext=.png}]{standalone}
\usepackage[utf8]{inputenc}
\usepackage{tikz}
\usepackage{enumitem}
\usepackage{graphicx}
\usetikzlibrary{arrows,shadows,decorations,backgrounds,fit,positioning,shapes,chains}
\usepackage{epstopdf}


\usepackage{pgf-umlsd}

\tikzset{font=\tiny}

\begin{document}

	\begin{sequencediagram}
	\renewcommand\unitfactor{0.6}
	\tikzstyle{inststyle}+=[bottom color=green, rounded corners=1.0ex]
		\newthread[white]{b}{Browser}
		\newinst[1]{f}{Flask (Gunicorn)}
		\newinst[2]{t}{ThreadManager (Singleton)}
		\newinst[1]{s}{SessionIDHandler (Singleton)}
		\newinst[1]{i}{ESInterfaceDownload (Thread)}
		\newinst[1]{e}{Elasticsearch (Docker-Container)}
	
	\begin{call}{b}{Trigger getAll()}{f}{return resultFile}
		\begin{call}{f}{addSession(SessionID)}{s}{}
		\end{call}
		\begin{call}{f}{getAll() inits Thread Manager}{t}{}  
			\begin{call}{t}{Init ESInterfaceDownload}{i}{Return ThreadFinished}
				\begin{call}{f}{getPasswordsAll}{i}{return totalHits, results[:50]}
					\begin{call}{i}{Bulk Pull 1000 Elements}{e}{Write Elements to file}
					\end{call}
				\end{call}

				\begin{sdblock}[green!20]{Push all results into file}{}
					\begin{call}{i}{Bulk Pull 1000 Elements}{e}{Write Elements to file}
					\end{call}
					\begin{call}{i}{updateProgress(SessionID)}{s}{}
					\end{call}
					\begin{sdblock}[green!20]{get Progress until finished}{}
							\begin{call}{f}{getProgress(SessionID)}{s}{returnProgress}
							\end{call}
					\end{sdblock}
				
				\end{sdblock}
			\end{call}	
		\end{call}
	\end{call}

	\end{sequencediagram}
\end{document}
